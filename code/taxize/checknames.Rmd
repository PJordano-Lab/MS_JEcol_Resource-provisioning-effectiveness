---
title: "Check names"
author: "Pedro Jordano"
date: "23/2/2017"
output: html_document
---

### Check install of `taxize`
```{r install}
if (!require("devtools")) install.packages("devtools")
devtools::install_github("ropensci/taxize")
library("taxize")

```

### Get list of names

```{r names}
names<- c("Penelope obscura","Aburria jacutinga","Ramphastos vitellinus","Ramphastos dicolorus","Procnias nudicollis","Selenidera maculirostris","Baillonius bailloni","Trogon viridis","Trogon surrucura","Tityra cayana","Euphonia violacea","Euphonia pectoralis","Thraupis sayaca","Tangara seledon","Turdus rufiventris","Turdus albicollis")

```

### Taxa names check
#### Cleanup list 

There are many ways to resolve taxonomic names in `taxize`. Of course, the ideal name resolver will do the work behind the scenes for you so that you don't have to do things like fuzzy matching. 

Here is code to check a specific database:

```{r select_source}
sources <- gnr_datasources()
eol <- sources$id[sources$title == 'EOL'] #c('ncbi','itis','col','tropicos')
tropicos<- sources$id[sources$title == 'tropicos'] #c('ncbi','itis','col','tropicos')
out1 <- gnr_resolve(names, data_source_ids=eol, stripauthority=TRUE)
out2 <- gnr_resolve(names, data_source_ids=tropicos, stripauthority=F)
birdlist1<- unique(out1$matched_name)

# Selecting ok names
birdlist1<- birdlist1[c(2,4,6,8,10,12,14,17,19,21,23,25,28,30,34,36)]
birdlist1

```

Now check the higher taxonomic categories.

```{r highercat, echo=T}
pp<- classification(names, db = 'gbif')

# Checking an alternative way, more elegant.
# ppp<- lapply(pp, function(x) {dplyr::select(x, name)})
# ppp<- as.data.frame(unlist(t(as.data.frame(ppp))))
highercat<- cbind(pp)
highercat<- highercat[,3:7]
highercat

```


## Names check and higher taxonomic categories

There are a few services in taxize like this we can choose from: One is the Taxonomic Name Resolution Service from iPlant (see function `tnrs`).

```{r cleanup, echo=TRUE, cache=TRUE}
# Plant names. I have to setup three vectors before getting the full list.
plnames1<- c("Alchornea triplinervia", "Cabralea canjerana", "Cupania oblongifolia", "Protium widgrenii", "Virola bicuhyba", "Euterpe edulis", "Psychotria suterella", "Virola gardneri", "Hyeronima alchorneoides", "Copaifera trapezifolia", "Garcinia gardneriana", "Marlierea tomentosa", "Sorocea ilicifolia", "Ficus enormis", "Citharexylum myrianthum", "Cordia silvestris", "Eugenia mosenii", "Cecropia pachystachya", "Eugenia melanogyna", "Marcgravia polyantha", "Heteropsis oblongifolia", "Coussarea contracta", "Pourouma guianensis", "Myrceugenia myrcioides", "Campomanesia xanthocarpa", "Ficus insipida", "Psychotria mapourioides", "Eugenia cuprea", "Sloanea guianensis", "Eugenia oblongata", "Acacia auriculiformis", "Acnistus arborescens", "Aegiphila integrifolia", "Aiouea saligna", "Alchornea glandulosa", "Alchornea sidifolia", "Allophyllus edulis", "Amaioua guianensis", "Amaioua intermedia", "Anacardium occidentale", "Annona neosericea", "Anthurium scandens", "Archontophoenix cunninghamiana", "Bactris gasipaes", "Byrsonima cydoniifolia", "Byrsonima ligustrifolia", "Byrsonima sericea", "Calophyllum brasiliense", "Calyptranthes concinna", "Campomanesia guaviroba", "Carica papaya", "Cecropia glaziovii", "Cecropia hololeuca", "Celtis iguanaea", "Cereus hildmannianus", "Cestrum mariquitense", "Chamissoa altissima", "Chomelia parvifolia", "Chrysophyllum flexuosum", "Cissus paulliniifolia", "Cissus selloana", "Cissus verticillata", "Citrus reticulata", "Citrus x aurantium", "Clusia criuva", "Copaifera langsdorffii", "Cordia curassicava", "Cordia ecalyculata", "Cordia sellowiana", "Cordiera myrciifolia", "Coussapoa microcarpa", "Cryptocarya mandioccana", "Cryptocarya moschata", "Cupania emarginata", "Cupania vernalis", "Curatella americana", "Dendropanax cuneatus", "Diospyros kaki", "Endlicheria paniculata", "Eriobotrya japonica", "Erythroxylum deciduum", "Erythroxylum pulchrum", "Eugenia astringens", "Eugenia brasiliensis", "Eugenia cerasiflora", "Eugenia handroi", "Eugenia hiemalis", "Eugenia involucrata", "Eugenia umbelliflora", "Eugenia uniflora", "Eugenia uruguayensis", "Euterpe oleracea")
plnames2<- c("Ficus benjamina", "Ficus citrifolia", "Ficus eximia", "Ficus hirsuta", "Ficus luschnathiana", "Ficus luschthia", "Ficus microcarpa", "Ficus organensis", "Ficus pertusa", "Ficus trigona", "Frangula purshiana", "Geonoma gamiova", "Guapira opposita", "Guarea macrophylla", "Guatteria australis", "Guatteria sellowiana", "Guettarda viburnoides", "Hedera nepalensis", "Henriettea saldanhaei", "Hovenia dulcis", "Ilex brevicuspis", "Ilex paraguariensis", "Ilex pseudobuxus", "Ilex theezans", "Inga edulis", "Inga marginata", "Ixora burchelliana", "Ixora gardneriana", "Lantana camara", "Lantana pohliana", "Leandra acutiflora", "Leandra carassana", "Leandra laevigata", "Leandra melastomoides", "Leandra variabilis", "Ligustrum japonicum", "Ligustrum lucidum", "Lithrea molleoides", "Livistona chinensis", "Maclura tinctoria", "Magnolia champaca", "Magnolia ovata", "Mangifera indica", "Margaritaria nobilis", "Margaritopsis astrellantha", "Marlierea obscura", "Marlierea reitzii", "Matayba elaeagnoides", "Matayba guianensis", "Maytenus aquifolia", "Maytenus brasiliensis", "Maytenus gonoclada", "Maytenus littoralis", "Melia azedarach", "Meliosma sellowii", "Miconia albicans", "Miconia budlejoides", "Miconia budlejoides", "Miconia cabucu", "Miconia chartacea", "Miconia cinerascens", "Miconia cinnamomifolia", "Miconia cuspidata", "Miconia elegans", "Miconia ligustroides", "Miconia minutiflora", "Miconia pepericarpa", "Miconia prasina", "Miconia pusilliflora", "Miconia theizans", "Miconia urophylla", "Mollinedia schottiana", "Mollinedia uleana", "Morus nigra", "Muntingia calabura", "Murraya paniculata", "Musa paradisiaca", "Myrcia anacardiifolia", "Myrcia brasiliensis", "Myrcia ferruginea", "Myrcia hebepetala", "Myrcia ilheosensis", "Myrcia oblongata", "Myrcia palustris", "Myrcia pubipetala", "Myrcia pulchra", "Myrcia spectabilis", "Myrcia splendens", "Myrcia tomentosa", "Myrciaria  glomerata", "Myrciaria cuspidata", "Myrciaria trunciflora", "Myriopus paniculatus", "Myrsine ferruginea", "Myrsine umbellata", "Myrsine venosa")
plnames3<- c("Nectandra cuspidata", "Nectandra grandiflora", "Nectandra lanceolata", "Nectandra megapotamica", "Nectandra membranacea", "Nectandra reticulata", "Ocotea bicolor", "Ocotea catharinensis", "Ocotea odorifera", "Ocotea puberula", "Ocotea pulchella", "Ocotea spixiana", "Ocotea spixiana", "Ocotea teleiandra", "Ouratea vaccinioides", "Paullinia carpopoda", "Paullinia micrantha", "Paullinia uloptera", "Pera glabrata", "Persea alba", "Persea willdenovii", "Philodendron appendiculatum", "Phoebe pickelli", "Phoenix sylvestris", "Phoradendron crassifolium", "Phoradendron piperoides", "Phoradendron quadrangulare", "Phytolacca dioica", "Piper aduncum", "Piper corintoanum", "Piper tectoniifolium", "Plinia cauliflora", "Podocarpus sellowii", "Protium heptaphyllum", "Protium spruceanum", "Prunus myrtifolia", "Prunus persica", "Psidium cattleianum", "Psidium guajava", "Psychotria gracilenta", "Psychotria leiocarpa", "Psychotria nuda", "Rhipsalis paradoxa", "Rhipsalis teres", "Richeria grandis", "Roystonea oleraceae", "Rudgea jasminoides", "Rudgea recurva", "Sapium glandulosum", "Schefflera actinophylla", "Schefflera angustissima", "Schefflera morototoni", "Schinus terebinthifolius", "Scutia buxifolia", "Siphoneugena densiflora", "Sloanea hirsuta", "Solanum bullatum", "Solanum granulosoleprosum", "Solanum mauritianum", "Solanum myrianthum", "Solanum thomasiifolium", "Solanum viscosissimum", "Styrax leprosus", "Syagrus romanzoffiana", "Symplocos glandulosomarginata", "Symplocos tetrandra", "Symplocos uniflora", "Syzygium cumini", "Tapirira guianensis", "Tetrorchidium rubrivenium", "Trema micrantha", "Trichilia catigua", "Trichilia clausseni", "Virola oleifera", "Virola sebifera", "Vitex megapotamica", "Vitex polygama", "Xylopia brasiliensis", "Xylopia langsdorfiana", "Xylopia sericea", "Zanthoxylum rhoifolium", "Aureliana fasciculata", "Cryptocarya aschersoniana", "Erythroxylum ambiguum", "Ilex microdonta", "Leandra pilonensis", "Miconia cubatanensis", "Miconia discolor", "Miconia inconspicua", "Miconia latecrenata", "Miconia racemifera", "Miconia sellowiana", "Miconia tristis", "Miconia valtheri", "Myrsine coriacea", "Myrsine lancifolia", "Neomitranthes glomerata", "Solanum variabile", "Myrcia fallax", "Casearia sylvestris", "Cinnamodendron dinisii", "Cissampelos andromorpha", "Coccocypselum hasslerianum", "Codonanthe cordifolia", "Fuchsia regia", "Leandra australis", "Leandra refracta", "Leandra sabiaensis", "Meliosma sinuata", "Myrsine gardneriana", "Ossaea amygdaloides", "Psychotria forsteronioides", "Psychotria vellosiana", "Quiina glazovii", "Rubus brasiliensis", "Rubus rosifolius", "Rubus urticifolius", "Solanum inodorum", "Struthanthus vulgaris", "Vassobia breviflora", "Senna macranthera", "Prunus sellowii", "Solanum erianthum")

# Now the full list.
plnames<-c(plnames1,plnames2,plnames3)
length(plnames)

# The tnrs function accepts a vector of 1 or more
mylist_tnrs <- tnrs(query=plnames, getpost="POST", source = "iPlant_TNRS")

# Remove some fields
mylist_tnrs <- mylist_tnrs[,!names(mylist_tnrs) %in%
               c("matchedName","annotations","uri")]
library(tibble)
mylist_tnrs_df <- as_tibble(mylist_tnrs)

mylist_final <- as.character(mylist_tnrs$acceptedname)
length(mylist_final)

```

Note the scores. They suggest that there were no perfect matches, but they were all very close, ranging from 0.77 to 0.99 (1 is the highest). 
Let's assume the names in the "acceptedName" column are correct (and they should be).




```{r save results}
write.csv(highercat, "bird_names.csv")
write.csv(mylist_tnrs_df, "plants_names.csv")
```

